# 更新日志

本文档记录了 AstrBot HTTP 渲染桥梁插件的所有重要更新和变更。

## [未发布] - 开发中

### 新增功能
- 📚 完整的文档体系重构
- 📁 文档整理到 `docs/` 目录
- 📖 新增文档中心和API参考

## [1.3.0] - 2024-10-30

### 新增功能
- 🎯 **NapCat消息类型支持** - 支持15种不同的消息类型
- 📝 文本、图片、语音、视频消息直接发送
- 👥 @用户、回复、转发消息支持
- 😀 表情、戳一戳、窗口抖动等互动功能
- 🎵 音乐、链接、位置分享功能
- 🎭 混合消息支持（文本+图片+@用户）
- 🔄 智能路由系统，根据请求头选择处理模式

### 改进
- 🔧 重构请求处理逻辑，分离模板渲染和直接消息发送
- 📊 完善错误处理和参数验证
- 📝 添加详细的消息类型使用指南

### 向后兼容
- ✅ 完全兼容现有HTML模板渲染功能
- ✅ 不设置 `X-Message-Type` 时默认使用模板模式

## [1.2.0] - 2024-10-30

### 新增功能
- 📸 **图片上传支持** - 支持多种格式图片上传和处理
- 🖼️ 支持JPG、PNG、GIF、WebP、BMP格式
- 📏 文件大小限制5MB，自动转换为base64
- 🎨 为notification模板添加图片显示支持
- 🖼️ 新增专门的image_showcase模板
- 📝 自动提供文件名和大小信息给模板

### 改进
- 🔧 优化multipart/form-data解析逻辑
- 📊 添加文件类型和大小验证
- 🚀 内存处理，无磁盘IO

## [1.1.0] - 2024-10-30

### 新增功能
- 🔗 **二维码自动生成** - 传入link参数自动生成二维码
- 🌐 使用在线API生成二维码（参考http_forwarder项目）
- 🎨 为多个模板添加二维码显示支持
- 📱 二维码显示在模板右上角，不影响主要内容
- 🔧 支持自定义qr_text参数设置二维码下方文字

### 改进
- 🎯 每个模板可以有自己的默认二维码文案
- 📝 nomination模板默认显示"扫码参与提名"
- 🔄 其他模板默认显示"扫码访问链接"

## [1.0.1] - 2024-10-30

### 改进
- 🔧 **移除无用参数** - 移除render_width和render_quality参数
- 📝 这些参数在代码中被存储但从未实际使用
- 🎯 AstrBot的html_render方法不支持自定义渲染选项
- 📋 简化配置文件和schema，移除冗余参数
- 🔄 保持与http_forwarder项目一致的简洁实现

### 修复
- 🐛 修复nomination模板二维码文案问题
- 🎨 让每个模板可以使用自己的默认二维码文案

## [1.0.0] - 2024-10-30

### 新增功能
- 🌐 **HTTP API接口** - 提供标准化的REST API
- 🔐 **Bearer Token认证** - 安全的API访问控制
- 🎨 **HTML模板系统** - 支持Jinja2模板引擎
- 🖼️ **本地图片生成** - 强制使用AstrBot本地渲染引擎
- 💎 **样式完整保留** - 直接渲染HTML，保留所有CSS样式
- 🔄 **智能后备机制** - HTML渲染失败时自动降级为Markdown
- 📤 **智能发送** - 支持群聊和私聊消息发送
- 🔧 **零配置模板** - 文件化模板管理，即放即用

### 内置模板
- 📢 notification.html - 通用通知消息
- ⚠️ alert.html - 警告和错误消息
- ✅ success.html - 成功和完成消息
- 🏆 nomination.html - 提名展示
- 📊 report.html - 数据报告
- 📄 default.html - 默认模板

### 技术特性
- 🚀 高性能本地渲染
- 📊 健康检查端点
- 📝 详细日志记录
- 🔧 灵活的配置系统

## 开发历程

### 设计理念
1. **简单易用** - 零配置模板管理，文件即模板
2. **功能完整** - 支持从简单文本到复杂HTML模板的全方位消息发送
3. **高度兼容** - 完全向后兼容，新功能不影响现有使用
4. **性能优先** - 本地处理，内存操作，高效稳定

### 技术选择
- **Jinja2** - 强大的模板引擎，支持复杂逻辑
- **aiohttp** - 异步HTTP服务器，高性能处理
- **本地渲染** - 避免网络依赖，提高稳定性
- **multipart/form-data** - 支持文件上传和复杂数据

### 架构演进
1. **v1.0** - 基础HTML模板渲染功能
2. **v1.1** - 添加二维码自动生成
3. **v1.2** - 添加图片上传支持
4. **v1.3** - 添加NapCat消息类型支持

---

## 贡献指南

### 版本号规则
- **主版本号** - 重大架构变更或不兼容更新
- **次版本号** - 新功能添加
- **修订版本号** - 问题修复和小改进

### 更新日志格式
- **新增功能** - 🎯 新功能描述
- **改进** - 🔧 改进内容
- **修复** - 🐛 修复的问题
- **向后兼容** - ✅ 兼容性说明

### 提交规范
- `feat:` - 新功能
- `fix:` - 问题修复
- `docs:` - 文档更新
- `refactor:` - 代码重构
- `test:` - 测试相关

---

**注意**: 本项目遵循[语义化版本](https://semver.org/lang/zh-CN/)规范。